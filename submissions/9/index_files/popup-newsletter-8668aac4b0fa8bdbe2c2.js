(window.webpackJsonp_gp_web_frontend=window.webpackJsonp_gp_web_frontend||[]).push([["popup-newsletter"],{"./src/ts/components/popup-newsletter/popup-newsletter.ts":(e,t,n)=>{"use strict";n.r(t),n.d(t,{getSignedUp:()=>d,getPageViewCount:()=>p,setPageViewCount:()=>u,getPopupDisplayStatus:()=>w,show:()=>g,hide:()=>h,subscribeToCRM:()=>_,increasePageView:()=>b,subscribe:()=>v,observeWindowScroll:()=>f,popupNewsletterComponent:()=>S,init:()=>j});var s=n("../react-components/dist/components/global/newsletter/popup-newsletter/popup-newsletter.css.json"),o=n("../shared-types/frontend/components/newsletter/subscription-status.ts"),i=n("../shared-types/frontend/core/store.ts"),r=n("../../node_modules/js-cookie/src/js.cookie.js"),c=n.n(r),a=n("./src/ts/utils/crm.ts"),l=n("./src/ts/utils/inview.ts");const d=()=>"true"===c().get(o.y.SignedUp),p=()=>parseInt(c().get(o.y.PageViewCount),10)||0,u=e=>{const t=new Date((new Date).getTime()+36e5);c().set(o.y.PageViewCount,e.toString(),{expires:t})},w=()=>{const e=localStorage.getItem("_TO_Pop_Display");return e&&Date.now()>parseInt(e,10)?(localStorage.removeItem("_TO_Pop_Display"),!1):!!e},m=(e,t)=>{e.setAttribute("hidden","false");const n=new Date;n.setMilliseconds(n.getMilliseconds()+1728e5),localStorage.setItem("_TO_Pop_Display",""+n.getTime()),t.dispatch({type:i.U.TrackEvent,payload:{pev2:"newsletter popup displayed",events:["event113"]}}),t.dispatch({type:i.U.DataLayerPush,payload:{action:"pop up",label:"newsletter",event:"in-view",category:"TO Impression"}})},g=(e,t)=>()=>{const n=document.querySelector("#inline-placement")||document.querySelector(".anyclip-placement");(null==n?void 0:n.childNodes.length)?(0,l.oO)({element:n,isNotInViewportCallback:()=>{m(e,t)}}):m(e,t)},h=(e,t)=>()=>{e.setAttribute("hidden","true"),t.dispatch({type:i.U.TrackEvent,payload:{pev2:"newsletter popup dismissed",events:["event207"]}})},_=(e,t)=>{const n=t.subscribe(()=>{const o=t.getState();if(e.querySelector("."+s.Fq).disabled=!1,o.crm.receive)n(),y(e,o.crm.receive.type);else if(o.crm.error){e.querySelector("."+s.N3).innerHTML=o.crm.error.message,e.classList.add(s.yt)}})},y=(e,t)=>{e.classList.add(s.UJ),"popup"===t&&(0,a.W)(t)},b=()=>{u(p()+1)},v=(e,t)=>n=>{n.preventDefault();const o=e.querySelector(`.${s.Y2}.${s.Do}`);e.querySelector("."+s.Fq).disabled=!0,(0,a.C)(t,{copyVersion:"0001",element:"newsletter-popup",email:o.value,referrer:window.location.href})},f=()=>new Promise(e=>{const t=()=>{(window.innerHeight+window.scrollY)/document.body.offsetHeight>=.6&&(e({}),window.removeEventListener("scroll",t))};window.addEventListener("scroll",t)}),S=(e,t)=>{const n={hide:h(e,t),show:g(e,t),bindEvents:()=>{b();const o=new URLSearchParams(window.location.search).get("cid");if(d()||w()||(()=>{const{city:e,language:t}=window.digitalData.page.pageInfo;return[{exemptCity:"barcelona",exemptLanguages:["en"]},{exemptCity:"madrid",exemptLanguages:["en"]}].some(({exemptCity:n,exemptLanguages:s})=>n===e.toLowerCase()&&s.includes(t.toLowerCase()))})()||o)return e.remove(),{};const i=h(e,t);return e.querySelector("."+s.Ah).addEventListener("click",n.hide),e.querySelector("."+s.cZ).addEventListener("click",i),e.querySelector("."+s.cr).addEventListener("submit",v(e,t)),1===p()?setTimeout(()=>{n.show()},4e4):f().then(n.show),_(e,t),{hide:n.hide}}};return n},j=(e,t)=>{const n=Math.floor(1e4*Math.random());return{listeners:S(e,t).bindEvents(),componentId:"navigation-"+n}}},"./src/ts/config/config.ts":(e,t,n)=>{"use strict";n.d(t,{p:()=>i,u:()=>r});var s=n("./src/ts/utils/config-utils.ts");let o={};const i=()=>{const e=(0,s.P)(),t=e.site||"uk-london",[n,i]=t.split("-"),r=e.locale||"en-GB",c=e.currency_symbol||"Â£",a=e.current_commit||null,l=e.graffiti||null,d=e.discover||null,p=e.auth||null,u=e.pageUID||null;return o={...o,site:t,city:i,country:n,locale:r,currencySymbol:c,currentCommit:a,graffiti:l,discover:d,auth:p,pageUid:u},o},r=e=>{var t;return null!==(t=o[e])&&void 0!==t?t:null}},"./src/ts/core/client.ts":(e,t,n)=>{"use strict";n.d(t,{uj:()=>c,Ef:()=>l,iu:()=>d});var s=n("../shared-types/frontend/core/store.ts"),o=n("./src/ts/config/settings.ts");let i,r=!1;const c=()=>window.innerWidth>=window.innerHeight?"landscape":"portrait",a=e=>{const{client:{breakpoint:t}}=e.getState(),n=(({width:e,currentBreakpoint:t,breakpoints:n=o.aj})=>(Object.entries(n).some(([n,{min_width:s,max_width:o}])=>{const i={min:!1,max:!1};return(e>=s||0===s)&&(i.min=!0),(e<=o||0===o)&&(i.max=!0),!(!i.min||!i.max||n===t)&&(t=n,!0)}),t))({width:window.innerWidth,currentBreakpoint:t});t!==n&&e.dispatch({type:s.U.ClientBreakpoint,payload:{breakpoint:n}})},l=()=>{if(r)return;const e=window.gpStore;i=e,(e=>{const t=()=>{a(e)};window.matchMedia(`(min-width: ${o.aj.sm.min_width}px)`).addListener(t),window.matchMedia(`(min-width: ${o.aj.md.min_width}px)`).addListener(t),window.matchMedia(`(min-width: ${o.aj.lg.min_width}px)`).addListener(t)})(e),(e=>{a(e)})(e),r=!0},d=()=>i.getState().client.breakpoint},"./src/ts/utils/config-utils.ts":(e,t,n)=>{"use strict";n.d(t,{P:()=>s,R:()=>o});const s=()=>{const e={};return document.querySelectorAll("meta").forEach(t=>{const n=t.name?t.name:t.getAttribute("property")||!1;n&&(e[n]=t.content?t.content:t.dataset)}),e},o=(e=document)=>e.querySelector("body").dataset.pageType},"./src/ts/utils/inview.ts":(e,t,n)=>{"use strict";n.d(t,{oe:()=>s,oO:()=>o,W0:()=>i});const s=e=>{if(!e)return!1;const t=e.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight,s=window.innerWidth||document.documentElement.clientWidth,o=t.top<=n&&t.top+t.height>=0,i=t.left<=s&&t.left+t.width>=0;return o&&i};function o({element:e,observerOptions:t={},isInViewportCallback:n,isNotInViewportCallback:s}){new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&n&&(s||t.unobserve(e.target),n(e)),!e.isIntersecting&&s&&(n||t.unobserve(e.target),s(e))})},t).observe(e)}function i(e,t){return e?new Promise(n=>{o({element:e,observerOptions:t,isInViewportCallback:n})}):Promise.reject()}},"../shared-types/frontend/components/newsletter/subscription-status.ts":(e,t,n)=>{"use strict";var s;n.d(t,{y:()=>s}),function(e){e.SignedUp="_TO_Newsletter_SignedUp",e.Dismissed="_TO_Newsletter_Dismissed",e.PageViewCount="_TO_Newsletter_PageViewCount"}(s||(s={}))},"../react-components/dist/components/global/newsletter/popup-newsletter/popup-newsletter.css.json":e=>{"use strict";e.exports=JSON.parse('{"UJ":"_hasSuccess_149je_26","Ah":"_closeButton_149je_51","cr":"_form_149je_82","Y2":"_textInput_149je_108","N3":"_errorMessage_149je_121","yt":"_hasEmailError_149je_133","Do":"_email_149je_133","Fq":"_submitButton_149je_146","cZ":"_dismissButton_149je_177"}')}}]);